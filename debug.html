<html>

<head>
    <title>RaspberryHome</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">

    <!-- Stylesheet imports -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/ripples.min.css" rel="stylesheet">
    <link href="css/material-wfont.min.css" rel="stylesheet">

</head>

<body>


<div class="navbar navbar-default">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">RaspberryLife</a>
    </div>
    <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
            <li><a href="index.html">Overview</a></li>
            <li class="active"><a href="debug.html">Debug</a></li>
            <li><a href="#">Link2</a></li>
        </ul>
        <form class="navbar-form navbar-right">
            <input type="text" class="form-control col-lg-8" placeholder="Search">
        </form>
    </div>
</div>

      <div id="content">
                <h1>Debug</h1>

                <br>
                <br>
                <textarea id="log" style="width: 100%; height: 200px"></textarea>
                <br />
                <input type="plainText" id="plainText" onblur="if (this.value=='') this.value=this.defaultValue" onclick="if (this.defaultValue==this.value) this.value=''" value="enter protobuf plaintext" />
                <button onclick="send()">Send protobuf message</button>
                <button onclick="sendGetDataMessage()">Get data set</button>
                <button onclick="sendAuthRequestMessage()">Send auth request</button>
                <button onclick="getModulID()">Get modul ID</button>


                <script>
                    var id = document.getElementById("id");
                    var mType = document.getElementById("mType");
                    var plainText = document.getElementById("plainText");


                     // Connect to websocket
                    var socket = new WebSocket("ws://localhost:6680/websocket-echo");
                    socket.binaryType = "arraybuffer";

                    socket.onopen = function () {
                        log.value += "> Connected\n";

                    };

                    socket.onclose = function () {
                        log.value += "> Disconnected\n";
                    };


                    socket.onmessage = function (message) {
                        try {
                            // Decode the Message
                            var message = RBHMessage.decode(message.data);
                            modulID = message.dataSet.modulID;
                            modulType = message.dataSet.fieldID;
                            modulValue = message.dataSet.count;
                            startDateTime = message.dataSet.startDateTime;
                            endDateTime = message.dataSet.endDateTime;
                            testFloat1 = message.dataSet.data;

                            log.value += "> Modul: " + modulID + "\n";
                            log.value += "> Einheit: " + modulType + "\n";
                            log.value += "> Wert: " + modulValue + "\n";
                            log.value += "> Datum von: " + startDateTime + "\n";
                            log.value += "> Datum bis: " + endDateTime + "\n";
                            log.value += "> Object type: " + Object.prototype.toString.call(testFloat1) + "\n";
                            log.value += "> data array length: " + testFloat1.length + "\n";


                        } catch (err) {
                            log.value += "> Error: " + err + "\n";
                        }
                    }


                    function getModulID() {
                        log.value += "MODUL ID: " + modulID + "\n";
                        return modulID;

                    }


                     // Send protobuf message
                    function send() {
                        if (socket.readyState == WebSocket.OPEN) {
                            var message = new RBHMessage("testid", RBHMessage.MessageType.PLAIN_TEXT, new RBHMessage.PlainText(plainText.value));
                            socket.send(message.toArrayBuffer());
                            log.value += "> Message Sent: " + message.plainText.text + "\n";
                            //socket.onmessage();
                        } else {
                            log.value += "> Not connected\n";
                        }
                    }


                    function sendGetDataMessage() {
                        if (socket.readyState == WebSocket.OPEN) {
                            var message = new RBHMessage("getdata", RBHMessage.MessageType.GET_DATA_SET, new RBHMessage.GetDataSet("livingrooom_sensormodule", "temp", 20, "bla", "bla2"));


                            socket.send(message.toArrayBuffer());

                            log.value += "> Get Data Request Sent\n";
                        } else {
                            log.value += "> Not connected\n";
                        }
                    }

                     // Send authentication request
                    function sendAuthRequestMessage() {
                        if (socket.readyState == WebSocket.OPEN) {
                            var message = new RBHMessage("authrequest", RBHMessage.MessageType.AUTH_REQUEST, new RBHMessage.PlainText("abc12345"));
                            socket.send(message.toArrayBuffer());
                            log.value += "> Authentication Request Sent\n";
                        } else {
                            log.value += "> Not connected\n";
                        }
                    }

                     // Clear log on reload
                    log.value = "";
                </script>



            </div>

<!-- Script imports -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script src="js/ripples.min.js"></script>
    <script src="js/material.min.js"></script>

</body>
</html>
